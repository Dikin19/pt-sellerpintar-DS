"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[600],{5077:(e,t,o)=>{o.d(t,{A:()=>r});let a=o(3464).A.create({baseURL:"https://test-fe.mysellerpintar.com/api",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let t=localStorage.getItem("authToken");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),a.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("authToken"),localStorage.removeItem("user"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT","/login"!==window.location.pathname&&(window.location.href="/login")),Promise.reject(e)});let r=a},5731:(e,t,o)=>{o.d(t,{$s:()=>c,BV:()=>l,GE:()=>r,HW:()=>h,K7:()=>u,bW:()=>i,iD:()=>g,st:()=>d,vO:()=>n,zZ:()=>s});var a=o(5077);async function r(e){try{let t=new URLSearchParams;(null==e?void 0:e.page)&&t.append("page",e.page.toString()),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.search)&&e.search.trim().length>0&&t.append("search",e.search.trim()),(null==e?void 0:e.categoryId)&&e.categoryId.trim().length>0&&t.append("categoryId",e.categoryId.trim());let o="/articles".concat(t.toString()?"?".concat(t.toString()):"");console.log("Making API call to:",o);let r=await a.A.get(o);if(!r.data)throw Error("No data received from API");return r.data}catch(e){throw console.error("getArticles error:",e),e}}async function n(e){return(await a.A.get("/articles/".concat(e))).data}async function i(e){let t=new URLSearchParams;(null==e?void 0:e.page)&&t.append("page",e.page.toString()),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.search)&&t.append("search",e.search);try{let o=await a.A.get("/categories?".concat(t.toString()));if(console.log("Raw categories API response:",o.data),Array.isArray(o.data)){console.log("API returned array format, wrapping in pagination");let t=o.data;t.forEach((e,t)=>{console.log("Raw category ".concat(t,":"),e),console.log("Raw category ".concat(t," keys:"),Object.keys(e)),e.id||e._id||e.categoryId||console.warn("Category ".concat(t," is missing ID field!"),e)});let a=t.filter(e=>e&&"object"==typeof e&&0!==Object.keys(e).length?!!e.name||!!e.title||(console.warn("Filtering out category without name:",e),!1):(console.warn("Filtering out empty or invalid category:",e),!1));console.log("Valid categories after filtering:",a);let r=a.map(e=>e.id?e:e._id?{...e,id:e._id}:e.categoryId?{...e,id:e.categoryId}:(console.warn("Category missing all possible ID fields, generating temporary ID:",e),{...e,id:"temp_".concat(Date.now(),"_").concat(Math.random())}));return{data:r,page:(null==e?void 0:e.page)||1,totalPages:1,total:r.length,pagination:{page:(null==e?void 0:e.page)||1,limit:(null==e?void 0:e.limit)||10,total:r.length,totalPages:Math.ceil(r.length/((null==e?void 0:e.limit)||10))}}}if(console.log("API returned paginated format"),o.data&&o.data.data&&Array.isArray(o.data.data)){console.log("Normalizing paginated categories data"),console.log("Raw paginated data:",o.data.data);let e=o.data.data.filter(e=>e&&"object"==typeof e&&0!==Object.keys(e).length?!!e.name||!!e.title||(console.warn("Filtering out category without name:",e),!1):(console.warn("Filtering out empty or invalid category:",e),!1));console.log("Valid categories after filtering:",e);let t=e.map(e=>e.id?e:e._id?{...e,id:e._id}:e.categoryId?{...e,id:e.categoryId}:(console.warn("Category missing ID field, generating temporary ID:",e),{...e,id:"temp_".concat(Date.now(),"_").concat(Math.random())}));return{...o.data,data:t}}return o.data}catch(t){return console.error("getCategories error:",t),{data:[],page:1,totalPages:1,total:0,pagination:{page:1,limit:(null==e?void 0:e.limit)||10,total:0,totalPages:1}}}}let l={deleteArticle:async function(e){await a.A.delete("/articles/".concat(e))},createArticle:async function(e){return(await a.A.post("/articles",e)).data},updateArticle:async function(e,t){let o={title:t.title,content:t.content,categoryId:t.categoryId};return(await a.A.put("/articles/".concat(e),o)).data}};async function c(e){return(await a.A.get("/categories/".concat(e))).data}async function s(e){try{return(await a.A.post("/categories",e)).data}catch(e){var t,o;if(console.error("createCategory error:",e),(null===(t=e.response)||void 0===t?void 0:t.status)===400)throw Error("Invalid category data provided");if((null===(o=e.response)||void 0===o?void 0:o.status)===500)throw Error("Server error occurred while creating category");throw e}}async function d(e,t){try{if(console.log("updateCategory called with:",{id:e,data:t}),!e||""===e.trim())throw Error("Category ID is required and cannot be empty");let o=await a.A.put("/categories/".concat(e),t);return console.log("updateCategory response:",o.data),o.data}catch(t){var o,r,n,i;if(console.error("updateCategory error:",t),console.error("Error response:",t.response),console.error("Error status:",null===(o=t.response)||void 0===o?void 0:o.status),console.error("Error data:",null===(r=t.response)||void 0===r?void 0:r.data),(null===(n=t.response)||void 0===n?void 0:n.status)===404)throw Error("Category with ID ".concat(e," not found"));if((null===(i=t.response)||void 0===i?void 0:i.status)===500)throw Error("Server error occurred while updating category");throw t}}async function u(e){try{await a.A.delete("/categories/".concat(e))}catch(a){var t,o;if(console.error("deleteCategory error:",a),(null===(t=a.response)||void 0===t?void 0:t.status)===404)throw Error("Category with ID ".concat(e," not found"));if((null===(o=a.response)||void 0===o?void 0:o.status)===500)throw Error("Server error occurred while deleting category");throw a}}async function g(e){return(await a.A.post("/auth/login",e)).data}async function h(){let e=localStorage.getItem("authToken");if(!e)throw Error("No authentication token found");let t=await fetch("/api/auth/me",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error((await t.json().catch(()=>({}))).error||"HTTP error! status: ".concat(t.status));return await t.json()}},7600:(e,t,o)=>{o.d(t,{As:()=>s,AuthProvider:()=>c,JT:()=>d});var a=o(5155),r=o(2115),n=o(5731);let i=(0,r.createContext)(void 0),l=e=>{try{let t=JSON.parse(atob(e.split(".")[1])),o=Date.now()/1e3;return t.exp<o}catch(e){return console.error("Error checking token expiration:",e),!0}};function c(e){let{children:t}=e,[o,c]=(0,r.useState)(null),[s,d]=(0,r.useState)(!0);(0,r.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(e&&t){if(l(e)){console.log("Token is expired, clearing auth data"),localStorage.removeItem("authToken"),localStorage.removeItem("user"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",d(!1);return}try{let e=JSON.parse(t);try{let e=await (0,n.HW)();c(e),console.log("Successfully restored auth state with fresh user data")}catch(t){console.warn("Failed to fetch current user, using saved user data:",t),c(e),console.log("Successfully restored auth state with saved user data")}}catch(e){console.error("Failed to parse saved user data:",e),localStorage.removeItem("authToken"),localStorage.removeItem("user"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"}}}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("authToken"),localStorage.removeItem("user"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"}finally{d(!1)}},g=()=>{console.log("Logging out user"),localStorage.removeItem("authToken"),localStorage.removeItem("user"),document.cookie="authToken=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",c(null),window.location.href="/login"},h=async()=>{try{let e=await (0,n.HW)();c(e)}catch(e){console.error("Failed to refresh user data:",e),g()}};return(0,a.jsx)(i.Provider,{value:{user:o,isLoading:s,isAuthenticated:!!o,login:(e,t)=>{console.log("Auth context login called with:",{token:!!e,userData:t}),localStorage.setItem("authToken",e),localStorage.setItem("user",JSON.stringify(t)),document.cookie="authToken=".concat(e,"; path=/; max-age=").concat(604800,"; SameSite=Lax"),c(t),console.log("User state updated:",t)},logout:g,refreshUser:h},children:t})}function s(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(){let{user:e}=s(),t=t=>(null==e?void 0:e.role)===t;return{hasRole:t,isAdmin:()=>t("Admin"),isUser:()=>t("User"),currentRole:null==e?void 0:e.role}}}}]);